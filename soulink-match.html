<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soulink Matches</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-100 text-gray-800 font-sans">
  <main class="p-6 max-w-5xl mx-auto">
    <h1 class="text-3xl font-bold text-center text-purple-700 mb-6">ðŸ”— Your Soul Matches</h1>
    <div id="matchesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Matches will be injected here -->
    </div>
  </main>

  <script type="module">
    import { db } from './firebase-config.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import { collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    const auth = getAuth();
    const matchesList = document.getElementById("matchesList");

    function createCard(user, score) {
      const card = document.createElement("div");
      card.className = "bg-white rounded-lg shadow p-4 space-y-2 text-center";

      const avatar = document.createElement("img");
      avatar.className = "w-20 h-20 rounded-full mx-auto shadow";
      avatar.src = user.avatar || "default-avatar.png";
      avatar.alt = "Avatar";

      const name = document.createElement("p");
      name.className = "text-lg font-bold";
      name.textContent = user.name || "No name";

      const matchScore = document.createElement("p");
      matchScore.innerHTML = `ðŸ’ž <strong>${score}%</strong> Match`;

      card.appendChild(avatar);
      card.appendChild(name);
      card.appendChild(matchScore);

      return card;
    }

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const querySnapshot = await getDocs(collection(db, "users"));
      const currentUserId = user.uid;
      let currentUserData;

      const users = [];

      querySnapshot.forEach((doc) => {
        const data = doc.data();
        if (doc.id === currentUserId) {
          currentUserData = data;
        } else {
          users.push({ id: doc.id, ...data });
        }
      });

      if (!currentUserData) return;

      users.forEach(match => {
        // Simple match score example (placeholder logic)
        let score = 0;
        if (match.loveLanguage === currentUserData.loveLanguage) score += 50;
        if (match.coreValue === currentUserData.coreValue) score += 50;

        const avatar = match.avatar || localStorage.getItem(`avatar_${match.id}`);
        const card = createCard({ name: match.name, avatar: avatar }, score);
        matchesList.appendChild(card);
      });
    });
  </script>
</body>
</html>
