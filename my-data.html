<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Data - Soulink</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="firebase-config.js"></script>
  <script type="module" src="db.js"></script>
  <script type="module" src="user-backup.js"></script>

</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-100 text-gray-800 font-sans">

  <header class="p-4 bg-white shadow sticky top-0 z-10 text-center">
    <h1 class="text-2xl font-bold">ğŸ“‚ My Soulink Data</h1>
    <p id="userEmail" class="text-sm text-gray-500"></p>
  </header>

  <main class="p-6 max-w-2xl mx-auto space-y-6">
    <section>
      <h2 class="text-lg font-semibold">ğŸ§ Profile</h2>
      <p><strong>Name:</strong> <span id="profileName">Loading...</span></p>
      <p><strong>Birthdate:</strong> <span id="profileBirthdate">Loading...</span></p>
    </section>

    <section>
      <h2 class="text-lg font-semibold">ğŸ”® Last Soulprint</h2>
      <div id="resultList">Loading...</div>
    </section>

    <section class="pt-4 space-x-4">
      <a href="edit-profile.html" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">âœï¸ Edit Profile</a>
      <a href="result.html" class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">ğŸ”® See Soulprint</a>
      <a href="logout.html" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">ğŸšª Log Out</a><button onclick="downloadUserData()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
  ğŸ“¥ Download My Soulprint
</button>

    </section>

    <p id="status" class="text-sm text-green-600 pt-4"></p>
  </main>

  <script type="module">
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { db } from './firebase-config.js';

    const auth = getAuth();
    const emailBox = document.getElementById("userEmail");
    const profileName = document.getElementById("profileName");
    const profileBirthdate = document.getElementById("profileBirthdate");
    const resultList = document.getElementById("resultList");
    const status = document.getElementById("status");

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        emailBox.textContent = `ğŸ” Logged in as: ${user.email}`;

        try {
          const profileSnap = await getDoc(doc(db, "users", user.email, "profile", "info"));
          if (profileSnap.exists()) {
            const data = profileSnap.data();
            profileName.textContent = data.name || "Not set";
            profileBirthdate.textContent = data.birthdate || "Not set";
          } else {
            profileName.textContent = "Not found";
            profileBirthdate.textContent = "Not found";
          }

          const resultsSnap = await getDoc(doc(db, "users", user.email, "results", "latest"));
          if (resultsSnap.exists()) {
            const data = resultsSnap.data();
            let html = "<ul class='list-disc pl-6'>";
            for (const key in data) {
              html += `<li><strong>${key}:</strong> ${data[key]}</li>`;
            }
            html += "</ul>";
            resultList.innerHTML = html;
          } else {
            resultList.innerHTML = "No results found.";
          }

        } catch (err) {
          status.textContent = "âŒ Error loading data.";
          console.error(err);
        }

      } else {
        emailBox.textContent = "âŒ Not logged in";
        status.textContent = "Please log in to view your data.";
      }
    });
  </script>

</body>
</html>
